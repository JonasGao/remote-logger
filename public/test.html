<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>测试工具</title>
  <link rel="stylesheet" type="text/css" href="./test.css"/>
</head>
<body>
  <section>
    <header>
      纯文本测试
    </header>
    <div>
      <form name="form1">
        <input type="text" name="content" value="1" required/>
        <button onclick="send()" type="button">发送</button>
      </form>
    </div>
    <div>
      <button onclick="useExample()" type="button">使用实例</button>
      <button onclick="autoSend(event)" type="button">自动发送测试</button>
    </div>
  </section>
  <section>
    <header>
      第二版格式测试
    </header>
    <form name="form2">
      <input type="text" name="content" value="2" required/>
      <button onclick="sendV2()" type="button">发送</button>
    </form>
  </section>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const example = '[realtime:staging]:DEBUG:[2019-03-29T02:21:59.020Z]:utils/request: responding [ /huashang/bi/hourly/getSalesAndInventoryDataSummary ] respond [ [200,""] [["cache-control","no-cache"],["connection","keep-alive"],["content-encoding","gzip"],["content-type","application/json;charset=UTF-8"],["date","Fri, 29 Mar 2019 02:21:59 GMT"],["transfer-encoding","Identity"],["vary","Accept-Encoding"]] ] {"code":"0","data":{"allUnit":76865.678,"allUnitYoY":-0.5745,"allAmount":1131013.84,"allAmountYoY":-0.5333,"allSaleProfit":24615.13,"allSaleProfitYoY":-0.8091,"flowCnt":18713,"flowCntYoY":-0.4885}}';

    const context = {}

    const socket = io({
      transports: ['websocket']
    });

    const useExample = () => {
      document.form1.content.value = example
    }

    const send = () => {
      const content = document.form1.content.value
      if (content) {
        socket.emit('log', content);
      }
    }

    const autoSend = event => {
      if (context.timer) {
        clearInterval(context.timer)
        context.timer = null
        event.target.innerHTML = context.timerBtnText;
        return
      }
      context.timerBtnText = event.target.innerHTML;
      event.target.innerHTML = '停止' + event.target.innerHTML;
      context.timer = setInterval(send, 500);
    }

    const sendV2 = () => {
      const content = document.form2.content.value
      if (content) {
        socket.emit('log', { v:2, app: 'V2 DEMO', content: content })
      }
    }
  </script>
</body>
</html>
