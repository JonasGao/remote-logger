<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>测试工具</title>
  <link rel="stylesheet" type="text/css" href="./test.css"/>
</head>
<body>
  <section>
    <header>
      纯文本测试
    </header>
    <div>
      <form name="form1">
        <input type="text" name="content" value="1" required/>
        <button onclick="send()" type="button">发送</button>
      </form>
    </div>
    <div>
      <button onclick="autoSend()" type="button">自动发送测试</button>
    </div>
  </section>
  <section>
    <header>
      第二版格式测试
    </header>
    <form name="form2">
      <input type="text" name="content" value="2" required/>
      <button onclick="sendV2()" type="button">发送</button>
    </form>
  </section>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const context = {
      timer: null
    }

    const socket = io({
      transports: ['websocket']
    });

    const send = () => {
      const content = document.form1.content.value
      if (content) {
        socket.emit('log', content);
      }
    }

    const autoSend = () => {
      if (context.timer) {
        clearInterval(context.timer)
        context.timer = null
        return
      }
      context.timer = setInterval(send, 500);
    }

    const sendV2 = () => {
      const content = document.form2.content.value
      if (content) {
        socket.emit('log', { v:2, app: 'V2 DEMO', content: content })
      }
    }
  </script>
</body>
</html>
